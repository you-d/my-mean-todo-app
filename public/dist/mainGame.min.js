var mainGame=function(t){function i(t,i,e){this.image=new Image,this.frameWidth=i,this.frameHeight=e;var n=this;this.image.onload=function(){n.framesPerRow=Math.floor(n.image.width/n.frameWidth)},this.image.src=t}function e(t,i,e,n){for(var a=[],s=0,m=0,h=e;h<=n;h++)a.push(h);this.update=function(){m==i-1&&(s=(s+1)%a.length),m=(m+1)%i},this.draw=function(i,e){var n=Math.floor(a[s]/t.framesPerRow),m=Math.floor(a[s]%t.framesPerRow);o.drawImage(t.image,m*t.frameWidth,n*t.frameHeight,t.frameWidth,t.frameHeight,i,e,t.frameWidth,t.frameHeight)}}function n(){c.reset(),this.playerWalkingAnimation(),a()}function a(){r||(c.drawAndUpdate(),m.anim.update(),m.anim.draw(133,129),setTimeout(function(){p(a)},1e3/h))}var s=document.getElementById("mainGameCanvas"),o=s.getContext("2d"),m={},h=20,g=2,r=!1,d=.3,u=1,f=!1,p=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame}(),w=function(){function t(t,i){"loading"===this[t][i].status&&(this[t][i].status="loaded",e++,e===this.totalAssets&&"function"==typeof this.finished&&this.finished())}var i="/images/";this.imgs={m_run:i+"m_run_58x58.png",m_shoot:i+"m_shoot_hg_53x53.png",m_thumbup:i+"m_thumbup_58x58.png",stage_1_fg:i+"stage_1_fg_321x224.png",stage_1_bg:i+"stage_1_bg_353x224.png"};var e=0,n=Object.keys(this.imgs).length;return this.totalAssets=n,this.downloadAssets=function(){var i,e=this;for(var n in this.imgs)this.imgs.hasOwnProperty(n)&&(i=this.imgs[n],function(e,n){e.imgs[n]=new Image,e.imgs[n].status="loading",e.imgs[n].name=n,e.imgs[n].onload=function(){t.call(e,"imgs",n)},e.imgs[n].src=i}(e,n))},{imgs:this.imgs,totalAssets:this.totalAssets,downloadAssets:this.downloadAssets}}(),c=function(){var t={},i={};return this.drawAndUpdate=function(){f||(t.x-=t.speed,i.x-=i.speed),o.drawImage(w.imgs.stage_1_bg,t.x,t.y),o.drawImage(w.imgs.stage_1_bg,t.x+s.width,t.y),o.drawImage(w.imgs.stage_1_fg,i.x,i.y),o.drawImage(w.imgs.stage_1_fg,i.x+s.width,i.y),t.x+w.imgs.stage_1_bg.width<=0&&(t.x=0),i.x+w.imgs.stage_1_fg.width<=0&&(i.x=0)},this.reset=function(){t.speed=d,t.x=0,t.y=0,i.speed=u,i.x=0,i.y=0},{drawAndUpdate:this.drawAndUpdate,reset:this.reset}}();return this.playerWalkingAnimation=function(){f&&this.panBackground(),m.width=58,m.height=58,m.speed=6,m.sheet=new i("/images/m_run_58x58.png",m.width,m.height),m.anim=new e(m.sheet,g,0,11)},this.playerShootingAnimation=function(){f||this.stopBackground(),m.width=53,m.height=53,m.speed=10,m.sheet=new i("/images/m_shoot_hg_53x53.png",m.width,m.height),m.anim=new e(m.sheet,g,0,11)},this.playerThumbUpAnimation=function(){f||this.stopBackground(),m.width=58,m.height=58,m.speed=10,m.sheet=new i("/images/m_thumbup_58x58.png",m.width,m.height),m.anim=new e(m.sheet,g,0,3)},this.stopBackground=function(){f=!0},this.panBackground=function(){f=!1},this.pauseGame=function(){r=!0},this.runGame=function(){r=!1,a()},this.startGame=function(){r=!1,w.downloadAssets(),w.finished=function(){n()}},{startGame:startGame,pauseGame:pauseGame,runGame:runGame,stopBackground:stopBackground,panBackground:panBackground,playerWalkingAnimation:playerWalkingAnimation,playerShootingAnimation:playerShootingAnimation,playerThumbUpAnimation:playerThumbUpAnimation}}(jQuery);mainGame.startGame();